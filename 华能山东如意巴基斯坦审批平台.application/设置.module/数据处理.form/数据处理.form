<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<form id="__7k26THT7xfazzZ1AMR2">
  <name>数据处理</name>
  <parentId>11e7-ef13-4f38d164-8f99-af63cc0890b3</parentId>
  <description></description>
  <templatecontext><![CDATA[<input classname="cn.myapps.runtime.dynaform.form.ejb.InputField" id="__WGFo72xN3V0w9fAWJ9M" text="hidden" name="txt" texttype="hidden" hidetype="parent" ishidetype="false" fieldtype="VALUE_TYPE_VARCHAR" fieldkeyevent="Tabkey" layout="horizontal" readonlyshowvalonly="true" showlog="true" arrow="false" discript="" validaterule="" valuescript="" width="" widthunit="px" hiddenscript="" hiddenvalue="" hiddenprintscript="" printhiddenvalue="" readonlyscript="" refreshonchanged="false" worklimitchecked="false" textareamaxlimit="" isdefaultvalue="false" calculateonrefresh="false" mobile="true" secrettext="false" defaultvalueisnull="false" numberpattern="" processdescription="[];[]" filtercondition="" instantvalidate="false" validatelibs="" editmode="01" refreshmode="0" refreshfields="" attributeid="undefined" /><br />
数据处理：<input classname="cn.myapps.runtime.dynaform.form.ejb.ButtonField" id="__uVuVOOOx2b3H54EIOCa" type="button" value="处理流程结束后的数据" name="处理流程结束后的数据" label="" colortype="" hiddenscript="" hiddenvalue="" hiddenprintscript="" printhiddenvalue="" readonlyscript="" refreshonchanged="false" calculateonrefresh="false" mobile="false" hidetype="parent" ishidetype="false" filenamescript="" statetoshow="" approvelimit="" beforeactionscript="" afteractionscript="" datafield="" signaturetype="HTML" signatureaction="signature" actiondispatcherurlscript="" actiontype="0" actionselection="0" actionscript="(function(){@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;docProcess@nbsp;=@nbsp;getDocumentProcess();@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;domainId@nbsp;=@nbsp;getDomainid();@nbsp;//@nbsp;提取变量，避免重复调用@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;application@nbsp;=@nbsp;getApplication();@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;初始化服务类@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;flowHistoryService@nbsp;=@nbsp;new@nbsp;(Java.type(@#146;cn.myapps.core.runtime.workflow.storage.runtime.ejb.FlowHistoryServiceImpl@#146;))(application);@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;flowRuntimeService@nbsp;=@nbsp;new@nbsp;(Java.type(@#146;cn.myapps.core.runtime.workflow.storage.runtime.ejb.FlowRuntimeServiceImpl@#146;))(application);@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;batchSize@nbsp;=@nbsp;500;@nbsp;//@nbsp;每批处理5000条@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;page@nbsp;=@nbsp;1;@nbsp;//@nbsp;分页起始页@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;while(true){@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;计算当前页的起始和结束行（Oracle@nbsp;12c分页语法，高效处理大数据量）@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;startRow@nbsp;=@nbsp;(page@nbsp;-@nbsp;1)@nbsp;*@nbsp;batchSize@nbsp;+@nbsp;1;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;endRow@nbsp;=@nbsp;page@nbsp;*@nbsp;batchSize;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;分页查询SQL（使用ROW_NUMBER()优化分页性能，避免OFFSET的低效问题）@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;sql@nbsp;=@nbsp;@quot;SELECT@nbsp;domainid,@nbsp;id,@nbsp;applicationid@nbsp;FROM@nbsp;(@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;SELECT@nbsp;@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;@nbsp;@nbsp;@#146;@quot;@nbsp;+@nbsp;domainId@nbsp;+@nbsp;@quot;@#146;@nbsp;as@nbsp;domainid,@nbsp;@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;@nbsp;@nbsp;docid@nbsp;as@nbsp;id,@nbsp;@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;@nbsp;@nbsp;@#146;@quot;@nbsp;+@nbsp;application@nbsp;+@nbsp;@quot;@#146;@nbsp;as@nbsp;applicationid,@nbsp;@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;@nbsp;@nbsp;ROW_NUMBER()@nbsp;OVER@nbsp;(ORDER@nbsp;BY@nbsp;docid)@nbsp;as@nbsp;rn@nbsp;@quot;@nbsp;+@nbsp;//@nbsp;按docid排序确保分页稳定@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;FROM@nbsp;t_relationhis@nbsp;@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;@nbsp;@nbsp;GROUP@nbsp;BY@nbsp;docid@quot;@nbsp;+@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@quot;)@nbsp;WHERE@nbsp;rn@nbsp;BETWEEN@nbsp;@quot;@nbsp;+@nbsp;startRow@nbsp;+@nbsp;@quot;@nbsp;AND@nbsp;@quot;@nbsp;+@nbsp;endRow;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;执行当前页查询@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;datas@nbsp;=@nbsp;queryBySQL(sql);@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;hasData@nbsp;=@nbsp;false;@nbsp;//@nbsp;标记当前页是否有数据@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;处理当前页的5000条数据@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;for(var@nbsp;iterator@nbsp;=@nbsp;datas.iterator();@nbsp;iterator.hasNext();){@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;hasData@nbsp;=@nbsp;true;@nbsp;//@nbsp;标记有数据@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;doc@nbsp;=@nbsp;iterator.next();@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;var@nbsp;currentDoc@nbsp;=@nbsp;docProcess.doView(doc.getId());@nbsp;//@nbsp;获取文档详情@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;仅处理状态符合条件的文档@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;if(currentDoc@nbsp;!=@nbsp;null@nbsp;@amp;@amp;@nbsp;currentDoc.getState()@nbsp;!=@nbsp;null@nbsp;@amp;@amp;@nbsp;currentDoc.getState().getState()@nbsp;==@nbsp;1048576){@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;创建流程历史记录@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;flowHistoryService.doCreateFlowHistory(currentDoc);@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;删除历史关联表数据@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;flowHistoryService.doRemoveRelationHISByDocument(currentDoc.getId());@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;删除当前审批表数据@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;flowRuntimeService.doRemoveFlowStateRT(currentDoc.getStateid());@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;flowRuntimeService.doRemoveNodeRTByFlowStateRT(currentDoc.getStateid());@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;}@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;}@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;//@nbsp;如果当前页没有数据，说明所有数据已处理完成，退出循环@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;if(!hasData){@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;break;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;}@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;@nbsp;page++;@nbsp;//@nbsp;处理下一页@amp;#13;@nbsp;@nbsp;@nbsp;@nbsp;}@amp;#13;})()" dispatcherurl="" dispatchermode="0" dispatcherparams="" acttype="13" actionview="" actionform="" actionflow="" relatedformid="" transpond="" actionprint="" jumptype="0" jumpmode="0" jumpactopentype="0" targetlist="" flowmode="2" withold="false" startflowscript="" flowshowtype="ST01" refreshmode="0" refreshfields="" impmappingconfigid="" />]]></templatecontext>
  <type>1</type>
  <styleId></styleId>
  <showLog>false</showLog>
  <showLogType>default</showLogType>
  <openComment>false</openComment>
  <commentTitleScript><![CDATA[]]></commentTitleScript>
  <commentFlagScript><![CDATA[]]></commentFlagScript>
  <commentHiddenScrtipt><![CDATA[]]></commentHiddenScrtipt>
  <commentExecuteScript><![CDATA[]]></commentExecuteScript>
  <recordMode>every</recordMode>
  <recordModeScript><![CDATA[]]></recordModeScript>
  <showType>old</showType>
  <showWaterMark>false</showWaterMark>
  <waterMarkScript></waterMarkScript>
  <version>1</version>
  <isopenablescript><![CDATA[]]></isopenablescript>
  <iseditablescript><![CDATA[]]></iseditablescript>
  <mappingStr><![CDATA[{"formName":"数据处理","tableName":"","columnMappings":[]}]]></mappingStr>
  <orderno>1</orderno>
  <permissionType>public</permissionType>
  <layoutType>horizontal</layoutType>
</form>